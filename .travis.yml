os: linux
language: android
jdk: oraclejdk8

env:
  global:
    # The same build tools version in the project.
    - BUILD_TOOLS_VERSION=29.0.2
    # Android API level used in this project.
    - API=29
    # Deploy properties.
    - secure: "UNWplQ5Ui5b6kgS6hk67W39NMnZtEefeXTwaeiuILnIAJgmgUHTjBO/YtmgdIKI2gfyDnFq1DUS3YQOgCK7MApzuMeX8s5IGIgpWJlJD7K/tgvlZSyjYl024TydiWiySv8hYYNSHOHjC2PTtLdc3CpsQoRyEr1suH3ZLfUTrVjVIJKQ0HVKXYcO9hKb4v71BjPnyO+OUKHCTc4jTr5XwpxU9lZnWchXoZ9KSvtgFSIBTiyyYU+To5zLnI9ycG1kqFypl7WWbwfvrueU7jTjSlcC6wZkB/D1satsbDCXlmItsaJGg+mM3csLZuXrlAQR7FsG3tqlBtaHhr8kSo6u/esYhWCP+COsLfgW5X015mpfhsO+heRAgg5iBarCkKPJ3jN/uclMwQoSyjvDNGsVXC9Y9zOLn9HCkZQbwTwaeO1u+RQuW7PdEGZUwDTBSOcXshr8QC0S+KEkuQA6PJHeeDyLFGmw3DN0+kzbrgO1VtZKVGxLV6EpzMCuXi3nivIG/NlzdKWQviL0BtvG2BPvMonp1Xq2sYDqBwp8XV3T4EfHKpepCAGjyfNXGata614DjNja3Pit6o5iaxeICYEIi7ha9nQzntqbB15OvdmhUAmyDs3NsPoWWjELBaHM2CXBGxQmZnaPUrShDk+MAgwOLynqqI1LE5K91iB37L031N/4="
    - secure: "lTYm/2zBal/ZyaKbTDjW7PH9E15vC0lUD/fFHTytpSq5WOMzW91OisA4GTmFrP9H4lpC7HAznYJcdaVgcVZiKVNu6BS7gzKziRZ1v+NP65MDWV7aOXw/J6iKsHEmo4DD3tmJhSgSXgO0sBaVyu5oJVHszrf833v0Z9VybLVW/XUpCXxHpRxC/3APTALRzX8t1IK4kBf4jME/Jfa/xIuS0yFB32Wpg3NQOmwqjoOq5AyGt2PuCWvtwuVepENvgf82abDtOEJkOafB2haOq86W8aXehjDC6T8fNzFghVFy4flcvIWiCAUkg6Pbktpnogrb+BcAqbvSE8GAUAs17FbFbnJkL8ihzBVTu+QeQTEnqpmUJcV88Oex1eM047fyISHJUO++WmyQHeICHsgz2I6xOzlX73rzkI2gLAYbvItHtNGQvLGEVTYrlVQrfb4XSc5n0knrsPmsiKszk0gA2iQGENf5jf2oOSqUgFT6oJXaA5U9sLjjbvheBZQioOqGja8NA4d4rynG0X0Twlhj3RZcqC8GCb7jhcNW7RCanb8O4mIF2NsreCieClmnM0YxmGejwUzjqIWe+2S2xlUQs3qlcxaTP08U9akZn8+FWkgqmpr0vEY+uufK1VVm6Hsk2oua7yx6lFcVheJbK2r2TOIWnUZFcljSLonfMx8PAsgfjwY="
    - secure: "EUp8E7h0je+t0FwORKp3Wy13fp/pH03NB9GsAHf828W2gPDbVohomHAOKE6HQNCK3sizFgQKY+nFStK4lv1dWvuxKOyt2Lo597Eb9ZTc15LPdrYoN/5exzfRVGT5/8isl43zZcci/vf4gxXgAPVhJn0TXjFdlE564FkZfNrV722a7+xj9a4ojfAWQqGaPLIKKJNA3lvUEM+mKZBetrQbjhRSX9T4Q6pIn7JKlTAbbbeUPiI2Pg8zOzvQpWhpNoDXISZZRaSCcoiiK0soJmfkba2ZsYyM54ixZUYodC1FjE2U/Via+86eOKN0NCKXWrbADCydWcm3VKTtr40ggl0UKuWyzgOtkJVosaeiy6bBPlsB83JYJX70up2/+CYQnwT7V9nmZSogecKUcCesD/oNkNK9XULUxKaNzW01+A8/R/qSlHTvqzJUXTRfsHJMdAdGaURkx3Sp5/3GmmdR/GIUQr7Lx6VHacw3V6iyDoXAH7qRG9ZOq330mJbpKFGEm35UK6otIx0CvlkCOJv6cmbwEaLic9X3Gq4qzeZg+HygVtu58Z1wc7G6SaA8zi0StqUWSrkVRWLT17z5AwRH8aNVleuSEZi2fK7ZmbKGVo5GJ8AfBMtQxPMD1FCaZwX4vYIBYZ90uoGM/cPtTrYY35NZcfl7glRMxI1G+cU+VsCP1X0="
    - secure: "Utx9iad/LcVnySTfal3FI6ZPEmU8C2bZ22pdNykqAjVxpsrZgMB9wgHpTsjp5p/dnVadOTJcBp1VGFn+NDNoEbjOMr2cEwHWv8BUBm27I0QbfYnnWX5e/bmslA1eOY2RNWUihiScr+0RtazAl+c3tV+jO8Hcd3NFSxbj+IfFv3Zx6qYu7SsCrns5AQjr/XMgiVU4c8GfucDoDQsPUioH27j0KyvbXFBfBuc4DXFLb6quhoAWGuwoc5MxoD07B0xRhZ0oFURJWphPUultwBFUDYzNS8GB/7En3MYpfsXtxbqWEVkCyHWr988XuZtBmXs1nygSGdIjVncqOpMiRCEs3OMy5mAoDqJri1SbwOnBaLUiK4FemzbUCsbplGiFEMw7dLAULN+TkpG0ORG8upsu9yHHgITtdkLmzMANwaxsb6Pl6abcDGOZZLtEH/VlGENztdyr2ouCo1d35zZk72qTly0D3Q94M2s7fhRaIMwgAcO+OmvhtzLdRSFuB64IovM5vDs0ReX5kyzrFoUluUMATWgxLLDEDqBUU99TYU4hkofqGXKGTX3XLtFKdN+16vawwCxccwFo1qTGjqX/RgqdXisohIEpMOzWQYgmK/LVedk6yCLJhYnssPypnlFVD14paDx/N/WWaatSF4b6zEC2g/dvGhAnpageJREH0Q2Cnno="

before_install:
  - yes | sdkmanager "platforms;android-${API}"
  - yes | sdkmanager "build-tools;${BUILD_TOOLS_VERSION}"

android:
  components:
    - tools
    - platform-tools
    # Support libraries.
    - extra-android-support
    - extra-android-m2repository
    - extra-google-m2repository

notifications:
  email: false

branches:
  only:
    - master
    # Matches all the tags in the format major.minor.patch (e.g. 1.12.3).
    # The regex must be surrounded with "/" following the Travis specs.
    - /^(\d+)\.(\d+)\.(\d+)$/

script:
  # The tests are skipped from the build task since they will be run directly with the coverage calculation.
  - ./gradlew build -x test testCoverage -s

deploy:
  provider: script
  script: ./gradlew publishLibrary -Pversion.name=$TRAVIS_TAG
  on:
    tags: true

after_success:
  # Uploads all the coverage reports to Codecov.io:
  # -Z -> if the upload of a report fails, the build fails too
  # -s -> searches in the paths in which CoveragePlugin generates the coverage reports
  # -f -> uploads the XML files found in the search paths (specified with -s)
  # -X -> excludes the tools not needed by this project
  - bash <(curl -s https://codecov.io/bash) -Z -s "**/build/coverageReport/test*Coverage/test*Coverage.xml" -f "*.xml" -X gcov -X coveragepy -X xcode -X gcovout

before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/

cache:
  directories:
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/
    - $HOME/.android/build-cache