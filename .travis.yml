os: linux
language: android
jdk: oraclejdk8

env:
  global:
    # The same build tools version in the project.
    - BUILD_TOOLS_VERSION=29.0.2
    # Android API level used in this project.
    - API=29
    # Deploy property named "bintray.api.key".
    - secure: "o34I1oOltj8nNsPtNYmBP6aDqN1VBAdfXX3o3IHOOKIMaCu4V+NDb/jA35nu+GnoA0aLPeFpsXgQ31FF+1UWY+OlnsZz9Z78YzMK70z0UemcAl09GxjNorztqnsqdlTc+fA15OpZZi8v4K3OxMjngafe6MHOMNye5G5Nhakv4ZiC20CyHo3PbURjBOLM4Ne3Az9eQGDXIEOtlhGyKUlxT9RedZH3hH/ZYidrky4vSaexmsk2mCDKCM7VJIGl5gwJSZUsUMEf7wbWVwvNQWmvtr0HbqTSIDXZBI09q00aUEP0iBaL28us8O+LUNPcHe7txJjJW6wvLGbVfW5NdJfgoEFxewOPA6z2fPvHzbFLEUejdjZKiMcA98nL8dS65S9A1cSGWJjTuQ6fYhACO1IQ3OPZfUOXYoq3NXqBwnQkdKofjkH628iZBMhNw9f3lzvTgzRatIbfZAnxhxYS3kCQ+uhJdlz4emKI+9XbZQDq2hj2p4iSPDXM7+hj70QOT43mvwVITSavZnrcW2t8ks2Oj1F5FfJVgp9fJY1+qbTi+t/kx5cNc06H3kNilLzVVk6QC3KJHn7M75RCJQYKLOCnU1nRXrpc7pJauL6kIE8CKiMUQItgtY/r02PcqpthlV4v2c52oZ/SkjSW5DbAQvbuezC5HQSbDo15myNjgF2Xavs="
    # Deploy property named "bintray.gpg.password".
    - secure: "Dt8znKvCWqLu+B4cwJgyZ10KcncRyKCcg4XJNmwOTkMKP3kw/3u6FXhYczYyPs/u5cg1NjgyyfRhvlJS0ayeb5tT5TX1bFiUDio35GVOIEXYnOAsL4ExI9iDspvBswj5JJQ6pfPkDCkrsCZioWhuKrzcDfRhCrA4ivvHZqS4Ab3B4Vdkums2mV39ek0op2a5by0k2Z0VatKkVIlQWWi8Pnwq/2U/wViuU1rb33gEJ04hkAu7FeU8gHkZBzElAZB1u9pEDt7qKf0ulkNVasO/HnSxb7muaaPi4Jlszq2iSPBWAOC85e4t80T0KrEzNxi0ebYR6F9mRbV0aT5GqhMuRaR4VDcib59qpJO2TRajn/ULp/WIRBOKju8gjfizEGB9MtFvDjrjJeHtMJ5jCAyQ1Rmy61OhkpY8WjeNS7Rnca75PGKQ9Ygm5gwvU5kzLwuMcVaxWDJzLu1VJt2IhWmZNUpJLYmfHUmYBSCl43DFBo4+1/h0TNq4EcxKpt6IQ8P1BkTa69LaXwzhFzhDBWrwu+r7rpmpj4q8ZbHQ1YgFrKDHXWoksNu2Mr/hL/2fzWrtWh9TOI7ZCBywsPAWUngemt7v6CDVDVNI0Y0t6TeaXShSD6CyjlmYHcSsIR8Ici7u2i7xWsNChv8wwBd6W49o4XHWYj+UI97gZ6qrWUA7ARs="
    # Deploy property named "maven.central.username".
    - secure: "TXp2Gu4pe42s1TWvwlWlurhHTUQoAYzkxGzAawmQ7MVMrgkOqLjzco4Fu97dvDHP9Nct2yJJpNg8e2P5tAvWfZvhfoqAHoVlPrjJbe2VuNHEfHgvQibLXn/H4oWCmzL5Sf/PAwD4mZUcdZ8pM9KWAl7OVMa0OscE9dCgg/3uVKNNxj8jgRO2pTGUou78d8UN1W+H7gnFDXgpcNB3+H2hBw+QwQz8qmyHqaZvTF0aGZepb4G8WPvjJhFVdnAOn0IT2PZHYGgRgb8VgNnzLzenAi/jJvRvYcW6I28ccGAf3eQuXaQKF9F1+TLV8c56Oar/BeRpPdmqr8723HxjiUpe+8wBsI1bX2ouI8HlpxvlLFKCyTW+KbBIgQ0NrSB6WHIIAbA3NNcN8/8OlQ/0szIe0ktZMk8J6oOeJX3nWUrvqJj+i0FA2Ov5S+CNsc0JHrvy5CDxnwPcG7BldBODn1SLeNeCIi70dPOgRh29/9IGwex+ywsrRD8jJNVf5U6wlsxLByzxVg+PYNZ3SxYiy+RektQGxnfqrXSFjjpdv9cBCMriJGiBkbxRsLW5dYYdoiwLRYF2D6SV+n1N/yN0nERuNY3/toOH5lf5NFDGVhAz45a6hV/ldlDCpqUXO7GYhJJh8+l2uyzNZE7f7WwIJtULAijapYt43pEu+uRJVrEcjik="
    # Deploy property named "maven.central.password".
    - secure: "nvRwntrnYMRb6wS6ZGeq1uJPDTQScq5epzWHdVELIRNqidcQgUXGV6MnCI4FYtidEsDBK5NcJpUl5I3HvEIEI+f0QLygNUh8u0c1xrHDmZteXrQlWK6YgcXLP6zd1kHmYv1Bfi9ovJyt7sl232gAgSLZ9aXyU5e827WjSnVwEaSoj1MCebiS8eMKGiTJ1I3Epg9SjdTmA9n76zaaqZ+fEeetYDbK2OOEULhfNw3DLUWluB1E85s8azgcN8O1j0Yjqye/ymu9buHeaSRTpWD3fRsosC/JnV44/8EAoBPTVBAg6u7pniF0uX+Aiz1AJ/EVVHy24azUgTovjoFhyZW13FkldNrOmoRGveKMAJRfyUztF21IeR1JhT+uP66cwuKBWJIi9gM4rZeJjFYJ66qk1rDzubBrVsyIMqcndPqGbEp2HxAn6bWnegVggghr7YscINI8x8K+M5xtS2ip2dV/ET0jI9YQCQwzm+LbqiTCMRPSBotd1wo1UV0ntEwzhYSXSWF3mVB+sOzx+KZNRfOGTb+uNFRF/blNJSybyilhq54C/Vla/zjn38jzqJnNrP22dF1j5bmYBcx2XXyLDSgKTklU/7vUi372Q+NzVcgA7bZbF0+iQYfxe8Vk3bEPoSNtrOfChp/jO0bbAUc8914k7cVHXjq9Jk0TEU8UYS2Yd4w="

before_install:
  - yes | sdkmanager "platforms;android-${API}"
  - yes | sdkmanager "build-tools;${BUILD_TOOLS_VERSION}"

android:
  components:
    - tools
    - platform-tools
    # Support libraries.
    - extra-android-support
    - extra-android-m2repository
    - extra-google-m2repository

notifications:
  email: false

branches:
  only:
    - master
    # Matches all the tags in the format major.minor.patch (e.g. 1.12.3).
    # The regex must be surrounded with "/" following the Travis specs.
    - /^(\d+)\.(\d+)\.(\d+)$/

script:
  # The tests are skipped from the build task since they will be run directly with the coverage calculation.
  - ./gradlew build -x test testCoverage -s

deploy:
  provider: script
  script: ./gradlew publishLibrary -Pversion.name=$TRAVIS_TAG
  on:
    tags: true

after_success:
  # Uploads all the coverage reports to Codecov.io:
  # -Z -> if the upload of a report fails, the build fails too
  # -s -> searches in the paths in which CoveragePlugin generates the coverage reports
  # -f -> uploads the XML files found in the search paths (specified with -s)
  # -X -> excludes the tools not needed by this project
  - bash <(curl -s https://codecov.io/bash) -Z -s "**/build/coverageReport/test*Coverage/test*Coverage.xml" -f "*.xml" -X gcov -X coveragepy -X xcode -X gcovout

before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/

cache:
  directories:
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/
    - $HOME/.android/build-cache