os: linux
language: android
jdk: oraclejdk8

env:
  global:
    # The same build tools version in the project.
    - BUILD_TOOLS_VERSION=29.0.2
    # Android API level used in this project.
    - API=29
    # Codecov.io token.
    - secure: "mXYz/TorS25GtRO5R2zRmt47Gs8UyrdcvywZWVT3xaiowQDNgaFy5SN3Yiwl5OyN1DzKZu8mIt+kddPrKQVDgNpCvr31cf9xw5e98S45zTLAGrR73UKPJzLZtKcxelrk8Cfi/UuisnCMHwirdCLjiDPnaRLn4ilTcsSb9U5NW/3J8jvYXPMZPe8pP9GFQeF3fF52Bq+zut0rN2ZJ0BnDhRDxsuobMj+KHTqtlJRoilm/23yjXwY6Mch4rf3KEKamePbcRtGryZbFaSq/ywi5EyHwEA6+4QQOBQAEFawc62IrpyAPFMpnpLGY1c5GM9p35oIppN4QTMKlEIBzQ4ywRO+2hUU+sl+WE176xrhDHH0/h6xL11SmoZyLN9ZdBITeHkRfdNobY578FWfCPE0zvl11aPCoQXtSziJB9Ef0xRS7UawtK5Zg6adFRm4KMY+6VLxU/vDRDmw+8nnCcpgm6ns2vVlK27n45+nGh0NPHQk3/z/0yj0Klpe/cI/A6vgSAQ06F6fZzXsM9T+ZDCK/Vjl6YFYIRCVp8+zXY7kNmV/uToUduzn82B9kHvb00QHUExFBwc2n8GdIHCN8eeaP3QSxBv+zcBE0haHVE5uV5xLgTnB/DXk1VC+rcwlIkriyX+1YheYsLgt/9HDTEd9s0sF9hKjAt7tXvQig3pFXIy0="

before_install:
  - yes | sdkmanager "platforms;android-${API}"
  - yes | sdkmanager "build-tools;${BUILD_TOOLS_VERSION}"

android:
  components:
    - tools
    - platform-tools
    # Support libraries.
    - extra-android-support
    - extra-android-m2repository
    - extra-google-m2repository

notifications:
  email: false

branches:
  only:
    - master

script:
  # Builds the library project, runs all its JVM tests and calculates the coverage.
  # It also assembles the sample with the local libs.
  - ./gradlew :kpermissions:check :kpermissions:build :kpermissions:testDebugUnitTestCoverage :sample:assembleLocal -s

after_success:
  - bash <(curl -s https://codecov.io/bash)

before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/

cache:
  directories:
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/
    - $HOME/.android/build-cache